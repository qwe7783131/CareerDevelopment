<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bugmaker.mapper.StudentMapper">

	<!-- 配置映射字段 -->
	<resultMap type="com.bugmaker.bean.Student" id="stuMap">
		<id property="id" column="u_id"/>

		<association property="user" javaType="com.bugmaker.bean.User">
			<result property="username" column="username" />
			<result property="password" column="password" />
			<result property="sex" column="sex" />
			<result property="age" column="age" />
			<result property="phone" column="phone" />
			<result property="email" column="email" />
			<result property="enable" column="enable" />
			<result property="type" column="type" />
			<result property="creatTime" column="create_time" />
		</association>

		<association property="professionClass" javaType="com.bugmaker.bean.ProfessionClass">
			<id property="id" column="pc_id"/>
			<result property="className" column="class_name"/>
			<association property="profession" javaType="com.bugmaker.bean.Profession">
				<id property="id" column="p_id" />
				<result property="name" column="p_name" />
				<result property="describe" column="p_describe" />
				<association property="dept" javaType="com.bugmaker.bean.Dept">
					<id property="id" column="d_id" />
					<result property="deptName" column="dept_name" />
				</association>
			</association>
		</association>

		<association property="directionClass" javaType="com.bugmaker.bean.DirectionClass">
			<id property="id" column="dc_id" />
			<result property="name" column="dc_name" />
			<association property="direction" javaType="com.bugmaker.bean.Direction">
				<id property="id" column="direct_id" />
				<result property="name" column="direct_name" />
				<result property="describe" column="direct_describe" />
			</association>
		</association>
	</resultMap>

	<!-- 查看所有学生 -->
	<select id="selectAllStudent" resultMap="stuMap">
		SELECT u.id u_id,username,password,sex,age,phone,email,enable,type,u.create_time,
			pc.id pc_id, pc.class_name,
			p.id p_id,p.name p_name,p.profess_describe p_describe,
			dc.id dc_id, dc.name dc_name,
			d.id d_id,d.dept_name,
			direct.id direct_id,direct.name direct_name,direct.describe direct_describe
		FROM student s, user u, profession_class pc, direction_class dc,
			 profession p, direction direct, dept d
		WHERE s.id = u.id AND s.direc_class_id = dc.id AND s.class_id = pc.id
			 AND pc.profession_id = p.id AND dc.direc_id = direct.id
			 AND direct.profess_id = p.id AND p.dept_id = d.id
	</select>

	<!-- 多条件查询学生 -->
	<select id="selectStudentByParams" parameterType="student" resultMap="stuMap">
		SELECT u.id u_id,username,password,sex,age,phone,email,enable,type,u.create_time,
		pc.id pc_id, pc.class_name,
		p.id p_id,p.name p_name,p.profess_describe p_describe,
		dc.id dc_id, dc.name dc_name,
		d.id d_id,d.dept_name,
		direct.id direct_id,direct.name direct_name,direct.describe direct_describe
		FROM student s, user u, profession_class pc, direction_class dc,
		profession p, direction direct, dept d
		WHERE s.id = u.id AND s.direc_class_id = dc.id AND s.class_id = pc.id
		AND pc.profession_id = p.id AND dc.direc_id = direct.id
		AND direct.profess_id = p.id AND p.dept_id = d.id

		<if test="user != null and user.id != null and user.id != ''">
			AND u.id = #{user.id}
		</if>
		<if test="user != null and user.username != null and user.username != ''">
			AND username LIKE '%' #{user.username} '%'
		</if>
		<if test="user != null and user.dept != null and user.dept != ''">
			AND u.dept_id = #{user.dept_id}
		</if>
		<if test="professionClass != null and professionClass.id != null and professionClass.id != ''">
			AND pc.id = #{professionClass.id}
		</if>
	</select>

	<!-- 添加学生 -->
	<insert id="insertStudent" parameterType="student">
		insert into student (
		id, class_id, direc_class_id)
		values
		(#{id}, #{professionClass.id}, #{directionClass.id})
	</insert>
	<!-- 批量添加学生 -->
	<insert id="insertStudents" parameterType="java.util.List" >
		insert into student (
		id, class_id, direc_class_id)
		values
		<foreach collection="list" item="item" index="index" separator ="," >
			(#{item.id}, #{item.professionClass.id}, #{item.directionClass.id})
		</foreach>
	</insert>


</mapper>