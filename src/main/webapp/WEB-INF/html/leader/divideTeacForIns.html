<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>指导老师分配</title>
		<#include "html/template/head.html" />
	</head>

	<body>
		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
			<legend>请先选择实习项目</legend>
		</fieldset>
		<form class="layui-form" action="${base}/toDivideTeachDinggang.do" method="post">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">实习项目</label>
					<div class="layui-input-inline">
						<select name="insId" lay-search id="insId">
							<option value="">请输入或选择实习项目</option>
							<#list map.internships as internship>
								<#if map.insId?? && (map.insId==internship.id)>
									<option value="${internship.id}" selected>${internship.name}</option>
									<#else>
									<option value="${internship.id}">${internship.name}</option>
								</#if>
							</#list>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<div class="layui-input-inline">
						<button lay-submit class="layui-btn" lay-filter="chooseIns">确定</button>
					</div>
				</div>
			</div>
		</form>
		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
			<legend>所有选此项目的教师</legend>
		</fieldset>
		<form class="layui-form" action="">
			<#if map.insId??>
			<div class="layui-row">
				<div class="layui-col-xs2 layui-col-sm2 layui-col-sm-offset1 layui-col-md1">
					<button class="layui-btn layui-btn-small" lay-submit lay-filter="divide1">
					<i class="layui-icon">&#xe608;</i> 分配给该项目
				</button>
				</div>
			</div>
			</#if>

			<table class="layui-table">
				<colgroup>
					<col width="10">
					<col width="150">
					<col width="200">
					<col width="150">
					<col width="150">
					<col width="200">
					<col width="150">
					<col width="200">
				</colgroup>
				<thead>
					<tr>
						<th>
							<div class="layui-form-item">
								<div class="layui-input-block">
									<input type="checkbox" name="chooseAllteac" value="${teacher.id}" lay-skin="primary" lay-filter="chooseAllteac">
								</div>
							</div>
						</th>
						<th>序号</th>
						<th>教工号</th>
						<th>姓名</th>
						<th>性别</th>
						<th>电话</th>
						<th>邮箱</th>
						<th>状态</th>
					</tr>
				</thead>
				<tbody>

					<#list map.teacIns as teacIns>

						<tr>
							<td>
								<div class="layui-form-item">
									<div class="layui-input-block">
										<input type="checkbox" name="teacherId1" value="${teacIns.teacher.id}" lay-skin="primary" lay-filter="chooseOneteac">
									</div>
								</div>
							</td>
							<td>#</td>
							<td>${teacIns.teacher.id}</td>
							<td>${teacIns.teacher.username}</td>
							<td>${teacIns.teacher.sex}</td>
							<td>${teacIns.teacher.phone}</td>
							<td>${teacIns.teacher.email}</td>
							<td>
								<div class="site-demo-button" id="layerDemo" style="margin-bottom: 0;">
									<button data-deptid="${dept.id}" data-deptname="${dept.deptName}" class="layui-btn layui-btn-normal layui-btn layui-btn-mini" id="modify-${dept.id}">修改</button>
									<button data-deptid="${dept.id}" data-deptname="${dept.deptName}" class="layui-btn layui-btn-danger layui-btn layui-btn-mini" id="delete-${dept.id}">删除</button>
								</div>
							</td>
						</tr>

					</#list>
				</tbody>
			</table>

			<div class="layui-row">
				<div class="layui-col-xs12 layui-col-sm8 layui-col-sm-offset2 layui-col-md6 layui-col-md-offset4">
					<div id="layPage1"></div>
				</div>
			</div>
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
				<legend>未选择实习项目的教师</legend>
			</fieldset>
			<#if map.insId??>
			<div class="layui-row">
				<div class="layui-col-xs2 layui-col-sm2 layui-col-sm-offset1 layui-col-md1">
					<button class="layui-btn layui-btn-small" lay-submit lay-filter="divide2">
					<i class="layui-icon">&#xe608;</i> 分配给该项目
				</button>
				</div>
			</div>
			</#if>
			<table class="layui-table">
				<colgroup>
					<col width="150">
					<col width="150">
					<col width="200">
					<col>
				</colgroup>
				<thead>
					<tr>
						<th>
							<div class="layui-form-item">
								<div class="layui-input-block">
									<input type="checkbox" name="chooseTeacNoChoose" value="${teacher.id}" lay-skin="primary" lay-filter="chooseTeacNoChoose">
								</div>
							</div>
						</th>
						<th>序号</th>
						<th>教工号</th>
						<th>姓名</th>
						<th>性别</th>
						<th>电话</th>
						<th>邮箱</th>
					</tr>
				</thead>
				<tbody>
					<#list map.teachers as teacher>
						<tr>
							<td>
								<div class="layui-form-item">
									<div class="layui-input-block">
										<input type="checkbox" name="teacherId2" value="${teacher.id}" lay-skin="primary" lay-filter="chooseOneNoChoose">
									</div>
								</div>
							</td>
							<td>#</td>
							<td>${teacher.id}</td>
							<td>${teacher.username}</td>
							<td>${teacher.sex}</td>
							<td>${teacher.phone}</td>
							<td>${teacher.email}</td>
						</tr>
					</#list>
				</tbody>
			</table>
		</form>
		<div class="layui-row">
			<div class="layui-col-xs12 layui-col-sm8 layui-col-sm-offset2 layui-col-md6 layui-col-md-offset4">
				<div id="layPage2"></div>
			</div>
		</div>
		<#include "html/template/common_js.html" />
		<script>
			layui.use(['laypage', 'form', 'layer', 'jquery'], function() {
				var laypage = layui.laypage,
					layer = layui.layer,
					$ = layui.jquery,
					form = layui.form;

				form.on('checkbox(chooseAllteac)', function(data) {
					if(data.elem.checked) {
						$("input[name='teacherId1']").prop("checked", true);
					} else {
						$("input[name='teacherId1']").prop("checked", false);
					}
					form.render('checkbox');
				});
				form.on('checkbox(chooseTeacNoChoose)', function(data) {
					if(data.elem.checked) {
						$("input[name='teacherId2']").prop(
							"checked", true);
					} else {
						$("input[name='teacherId2']").prop(
							"checked", false);
					}
					form.render('checkbox');
				});
				form.on('submit(divide1)', function(data) {
					var checkbox = $('input:checkbox[name=teacherId1]:checked');
					if(checkbox.length>0){
						layer.msg('确定分配吗？', {
							btn: ['确定', '取消'],
							yes: function(){
								var array = new Array(),i = 0;
								var insId = $("#insId").val();
								checkbox.each(function(){
									array[i] = checkbox[i++].value;
								});
								$.ajax({
									url: '${base}/diviTeachers.do',
									data: {
										teacIds : array,
										insId : insId
									},
									type: 'POST',
									traditional: true,//如果你想要用传统的方式来序列化数据，那么就设置为true。请参考工具分类下面的jQuery.param 方法.
									success: function(data){
										if(data == '1'){
											setTimeout("window.location.reload()",3000);
											layer.msg("分配成功！3秒后刷新界面",{icon: 1});
										}else{
											layer.msg("分配失败！",{icon: 2});
										}
									}
								});
							}
						});
						
					}else{
						layer.msg("请先选择教师！",{icon: 5});
					}
					
					return false;
				});
				form.on('submit(divide2)', function(data) {
					var checkbox = $('input:checkbox[name=teacherId2]:checked');
					if(checkbox.length>0){
						
					}else{
						layer.msg("请先选择教师！",{icon: 5});
					}
					
					return false;
				});

				$("[id^='open-']").click(function() {
					var directId = $(this).data("directid");
					func.open(directId);
				});
				$("[id^='close-']").click(function() {
					var directId = $(this).data("directid");
					func.close(directId);
				});
				$("#onekey-open").click(function() {
					func.onekeydo("1");
				});
				$("#onekey-close").click(function() {
					func.onekeydo("0");
				});
				var func = {
					open: function(directId) {
						layer.msg('确定开启吗？', {
							btn: ['开启', '取消'],
							yes: function() {
								$.ajax({
									url: '${base}/modifyDirectionState.do',
									data: {
									directId: directId,
									action: '1'
									},
									type: 'POST',
									success: function(data) {
										if(data == '1') {
											setTimeout("window.location.reload()",3000);
											layer.msg("开启成功！3秒后刷新页面！", {icon: 1});
										} else {
											layer.msg("开启失败！3秒后刷新页面！", {icon: 2});
										}
									}
								});
							}
						});
					},
					close: function(directId) {
						layer.msg('确定关闭吗？', {
							btn: ['关闭', '取消'],
							yes: function() {
								$.ajax({
									url: '${base}/modifyDirectionState.do',
									data: {
										directId: directId,
										action: '0'
									},
									type: 'POST',
									success: function(data) {
										if(data == '1') {
											setTimeout("window.location.reload()",3000);
											layer.msg("关闭成功！3秒后刷新页面！", {icon: 1});
										} else {
											layer.msg("关闭失败！3秒后刷新页面！", {icon: 2});
										}
									}
								});
							}
						});
					},
					onekeydo: function(open_or_close) {
						var msg = "";
						if(open_or_close == "1") {
							msg = "开启";
						} else {
							msg = "关闭";
						}
						layer.msg('确定一键' + msg + '关闭吗？', {
							btn: [msg, '取消'],
							yes: function() {
								$.ajax({
									url: '${base}/onKeyOpenOrClose.do',
									data: {
										openOrClose: open_or_close
									},
									type: 'POST',
									success: function(data) {
										if(data == '0') {
											layer.msg(msg+"失败！", {icon: 2});
										} else {
											setTimeout("window.location.reload()",3000);
											layer.msg(msg +"成功！3秒后刷新页面！", {icon: 1});
										}
									}
								});
							}
						});
					}
				};
				//执行一个分页
				laypage.render({
					elem: 'layPage1', //注意，这里的 test1 是 ID，不用加 # 号
					count: 50, //${map.page.total}, //数据总数，从服务端得到
					limit: 5, //${map.page.pageSize}, //每页条数
					groups: 5,
					curr: 1, //${map.page.pageNum},
					layout: ['prev', 'page', 'next', 'count'],
					jump: function(obj, first) {
						if(!first) {
							//window.location.href="${base}/toModifyProfessState.do?curr="+obj.curr;
						}
					}
				});
				laypage.render({
					elem: 'layPage2', //注意，这里的 test1 是 ID，不用加 # 号
					count: 50, //${map.page.total}, //数据总数，从服务端得到
					limit: 5, //${map.page.pageSize}, //每页条数
					groups: 5,
					curr: 1, //${map.page.pageNum},
					layout: ['prev', 'page', 'next', 'count'],
					jump: function(obj, first) {
						if(!first) {
							//window.location.href="${base}/toModifyProfessState.do?curr="+obj.curr;
						}
					}
				});
			});
		</script>
	</body>

</html>